<!DOCTYPE html>
<html lang="ne">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>समानता पोर्टल — Police Report Dashboard</title>
    <link
      rel="icon"
      type="image/png"
      href="./assets/Logo_samanta_WebApp-modified.png"
    />

    <!-- jsPDF for Download PDF (CDN) -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

    <style>
      :root {
        --navy: #0b4f86;
        --primary: #0b5fb6;
        --accent: #10b981;
        --bg: #f6fbff;
        --card: #fff;
        --muted: #7b9dbf;
        --radius: 8px;
      }
      * {
        box-sizing: border-box;
      }
      body {
        margin: 0;
        font-family: Inter, system-ui, -apple-system, "Segoe UI", Roboto,
          "Noto Sans Devanagari", Arial;
        background: linear-gradient(180deg, #f8fbff 0%, var(--bg) 100%);
        color: #0b2a44;
        -webkit-font-smoothing: antialiased;
      }

      header.topbar {
        background: var(--navy);
        color: #fff;
        padding: 18px 20px;
        display: flex;
        align-items: center;
        gap: 16px;
      }
      header.topbar img.logo {
        width: 54px;
        height: 54px;
        object-fit: contain;
        border-radius: 8px;
        background: linear-gradient(180deg, #e8f6ff, #fff);
        padding: 6px;
        border: 1px solid rgba(255, 255, 255, 0.06);
      }
      header.topbar h1 {
        margin: 0;
        font-size: 20px;
        font-weight: 700;
        letter-spacing: 0.2px;
      }
      header.topbar p {
        margin: 0;
        font-size: 12px;
        opacity: 0.9;
      }

      .wrap {
        max-width: 1200px;
        margin: 24px auto;
        padding: 0 18px;
      }

      .card {
        background: var(--card);
        border-radius: var(--radius);
        padding: 18px;
        border: 1px solid #dbeffb;
        box-shadow: 0 6px 18px rgba(11, 95, 182, 0.04);
      }

      .title {
        text-align: center;
        color: var(--navy);
        font-size: 22px;
        font-weight: 800;
        margin: 10px 0 16px;
      }

      /* search */
      .search-row {
        display: flex;
        gap: 12px;
        margin-bottom: 14px;
      }
      .search-row input[type="text"] {
        flex: 1;
        padding: 12px 14px;
        border-radius: 8px;
        border: 1px solid #d7eaff;
        font-size: 15px;
      }
      .search-row button {
        padding: 12px 18px;
        background: #c81e1e; /* red like sample */
        color: #fff;
        border: none;
        border-radius: 8px;
        cursor: pointer;
        font-weight: 700;
      }

      /* table */
      table.report-table {
        width: 100%;
        border-collapse: collapse;
        margin-top: 8px;
      }
      table.report-table th,
      table.report-table td {
        border: 1px solid #cfe6ff;
        padding: 10px 8px;
        text-align: left;
        font-size: 14px;
      }
      table.report-table th {
        background: #f0f9ff;
        font-weight: 700;
        color: var(--navy);
      }
      table.report-table td a {
        color: var(--primary);
        text-decoration: underline;
        cursor: pointer;
      }

      .controls {
        display: flex;
        gap: 12px;
        align-items: center;
        margin-top: 12px;
      }
      .controls a.btn {
        display: inline-block;
        padding: 8px 14px;
        background: var(--primary);
        color: #fff;
        border-radius: 6px;
        text-decoration: none;
        font-weight: 700;
      }
      .controls a.link {
        color: var(--primary);
        text-decoration: underline;
        font-weight: 600;
      }

      /* detail panel (below) */
      .detail-title {
        text-align: center;
        margin: 18px 0 8px;
        font-weight: 800;
        color: var(--navy);
        font-size: 20px;
      }
      .detail-grid {
        width: 100%;
        border-collapse: collapse;
        margin-top: 12px;
      }
      .detail-grid td {
        padding: 10px 12px;
        border: 1px solid #e6f2ff;
        vertical-align: top;
        font-size: 15px;
      }
      .detail-grid td.label {
        width: 220px;
        background: #f4fbff;
        font-weight: 700;
        color: var(--navy);
      }

      .detail-actions {
        text-align: center;
        margin-top: 18px;
      }
      .detail-actions button {
        padding: 10px 16px;
        border-radius: 8px;
        border: none;
        background: var(--primary);
        color: #fff;
        font-weight: 700;
        cursor: pointer;
      }

      /* responsive */
      @media (max-width: 900px) {
        .search-row {
          flex-direction: column;
        }
        .search-row button {
          width: 100%;
        }
        table.report-table th,
        table.report-table td {
          font-size: 13px;
          padding: 8px;
        }
        .detail-grid td.label {
          width: 140px;
          font-size: 13px;
        }
      }
    </style>
  </head>
  <body>
    <header class="topbar" role="banner">
      <!-- Use uploaded local image path (logo/chatbot) -->
      <img
        class="logo"
        src="./assets/Logo_samanta_WebApp-modified.png"
        alt="Samanta Portal Logo"
      />
      <div>
        <h1>समानता पोर्टल</h1>
        <p>Samanta Portal — Police Reports Dashboard</p>
      </div>
    </header>

    <div class="wrap">
      <div class="card">
        <div class="title">Police Reports / प्रहरी उजुरीहरू</div>

        <div class="search-row">
          <input
            id="searchInput"
            type="text"
            placeholder="Search by Name or Darta Number (e.g., D-001)..."
          />
          <button id="searchBtn">Search</button>
        </div>

        <div style="overflow: auto">
          <table
            class="report-table"
            id="reportsTable"
            aria-describedby="tableCaption"
          >
            <caption id="tableCaption" style="display: none">
              List of registered complaints
            </caption>
            <thead>
              <tr>
                <th>SN</th>
                <th>Full Name</th>
                <th>Contact</th>
                <th>Email</th>
                <th>Address</th>
                <th>Date of Incident</th>
                <th>Darta No.</th>
                <th>Type</th>
                <th>Action</th>
              </tr>
            </thead>
            <tbody id="reportsBody">
              <!-- rows injected by JS -->
            </tbody>
          </table>
        </div>

        <div class="controls">
          <a class="btn" id="downloadCsv">Download CSV</a>
        </div>
      </div>

      <!-- Detail card (hidden until a record is chosen) -->
      <div class="card" id="detailCard" style="display: none; margin-top: 18px">
        <div class="detail-title">Complaint Details / उजुरी विवरण</div>

        <table class="detail-grid" id="detailGrid">
          <!-- rows filled by JS -->
        </table>

        <div class="detail-actions">
          <button id="downloadPdf">Download PDF</button>
          <a
            id="backToList"
            href="#"
            style="
              margin-left: 12px;
              color: var(--primary);
              font-weight: 700;
              text-decoration: underline;
            "
            >Back to Complaints List</a
          >
        </div>
      </div>
    </div>

    <script>
      (() => {
        // Sample data array (replace / extend with your real data)
        const complaints = [
          {
            darta: "D-001",
            fullName: "Sita Sharma",
            address: "Janakpurdham - 15",
            contact: "9801234567",
            email: "sita@example.com",
            incidentDate: "2025-11-20",
            location: "Janakpurdham, Dhanusha",
            type: "यौन उत्पीडन / Sexual harassment",
            description:
              "Workplace harassment reported by complainant at office.",
            accused: "John Doe (co-worker)",
            evidence: "photo1.jpg",
            status: "Open",
            submittedAt: "2025-11-21",
          },
          {
            darta: "D-002",
            fullName: "Ram Koirala",
            address: "Birgunj - 2",
            contact: "9812345670",
            email: "ram.koirala@mail.com",
            incidentDate: "2025-11-18",
            location: "Birgunj, Parsa",
            type: "घरेलु हिंसा / Domestic violence",
            description:
              "Domestic violence case, requested immediate intervention.",
            accused: "Relative name not provided",
            evidence: "",
            status: "Assigned",
            submittedAt: "2025-11-18",
          },
          {
            darta: "D-003",
            fullName: "Sajan Thakur",
            address: "Kathmandu - 20",
            contact: "9809999112",
            email: "",
            incidentDate: "2025-11-10",
            location: "Kathmandu",
            type: "धम्की / Threat",
            description: "Telephone threats from unknown number.",
            accused: "",
            evidence: "audio1.mp3",
            status: "Investigating",
            submittedAt: "2025-11-10",
          },
        ];

        const reportsBody = document.getElementById("reportsBody");
        const detailCard = document.getElementById("detailCard");
        const detailGrid = document.getElementById("detailGrid");
        const searchInput = document.getElementById("searchInput");
        const searchBtn = document.getElementById("searchBtn");
        const downloadCsvBtn = document.getElementById("downloadCsv");
        const backToList = document.getElementById("backToList");

        // Render table rows
        function renderTable(list = complaints) {
          reportsBody.innerHTML = "";
          list.forEach((c, idx) => {
            const tr = document.createElement("tr");
            tr.innerHTML = `
        <td>${idx + 1}</td>
        <td>${escapeHtml(c.fullName)}</td>
        <td>${escapeHtml(c.contact)}</td>
        <td>${escapeHtml(c.email || "—")}</td>
        <td>${escapeHtml(c.address)}</td>
        <td>${escapeHtml(c.incidentDate)}</td>
        <td><a class="darta-link" data-darta="${escapeHtml(
          c.darta
        )}">${escapeHtml(c.darta)}</a></td>
        <td>${escapeHtml(c.type)}</td>
        <td><a class="view-link" data-darta="${escapeHtml(
          c.darta
        )}">View</a></td>
      `;
            reportsBody.appendChild(tr);
          });

          // Attach listeners to view links and darta links
          document.querySelectorAll(".view-link, .darta-link").forEach((a) => {
            a.addEventListener("click", (e) => {
              e.preventDefault();
              const id = e.currentTarget.dataset.darta;
              openDetailByDarta(id);
            });
          });
        }

        // Escape HTML helper
        function escapeHtml(str) {
          return String(str || "").replace(
            /[&<>"]/g,
            (c) =>
              ({ "&": "&amp;", "<": "&lt;", ">": "&gt;", '"': "&quot;" }[c])
          );
        }

        // Open detail by darta number
        function openDetailByDarta(darta) {
          const rec = complaints.find((x) => x.darta === darta);
          if (!rec) {
            alert("Record not found for Darta: " + darta);
            return;
          }
          showDetail(rec);
        }

        // Show detail panel content
        function showDetail(rec) {
          detailGrid.innerHTML = `
      <tr><td class="label">Full Name</td><td>${escapeHtml(
        rec.fullName
      )}</td></tr>
      <tr><td class="label">Permanent Address</td><td>${escapeHtml(
        rec.address
      )}</td></tr>
      <tr><td class="label">Contact Number</td><td>${escapeHtml(
        rec.contact
      )}</td></tr>
      <tr><td class="label">Email</td><td>${escapeHtml(
        rec.email || "—"
      )}</td></tr>
      <tr><td class="label">Date of Incident</td><td>${escapeHtml(
        rec.incidentDate
      )}</td></tr>
      <tr><td class="label">Location of Incident</td><td>${escapeHtml(
        rec.location
      )}</td></tr>
      <tr><td class="label">Type of Complaint</td><td>${escapeHtml(
        rec.type
      )}</td></tr>
      <tr><td class="label">Detailed Description</td><td>${escapeHtml(
        rec.description
      )}</td></tr>
      <tr><td class="label">Details of Accused</td><td>${escapeHtml(
        rec.accused || "—"
      )}</td></tr>
      <tr><td class="label">Evidence</td><td>${escapeHtml(
        rec.evidence || "—"
      )}</td></tr>
      <tr><td class="label">Darta Number</td><td>${escapeHtml(
        rec.darta
      )}</td></tr>
      <tr><td class="label">Status</td><td>${escapeHtml(
        rec.status || "—"
      )}</td></tr>
      <tr><td class="label">Submitted At</td><td>${escapeHtml(
        rec.submittedAt || "—"
      )}</td></tr>
    `;
          detailCard.style.display = "block";
          window.scrollTo({
            top: detailCard.offsetTop - 20,
            behavior: "smooth",
          });

          // set download pdf handler with the record
          document.getElementById("downloadPdf").onclick = () =>
            downloadPdf(rec);
        }

        // Download PDF (jsPDF)
        async function downloadPdf(rec) {
          const { jsPDF } = window.jspdf;
          const doc = new jsPDF({ unit: "pt", format: "a4" });
          const left = 40;
          let y = 60;

          // Header
          doc.setFontSize(18);
          doc.setTextColor(10, 60, 110);
          doc.text("समानता पोर्टल — Complaint Detail", 40, y);
          y += 28;

          doc.setFontSize(12);
          doc.setTextColor(0, 0, 0);

          const rows = [
            ["Darta Number", rec.darta],
            ["Full Name", rec.fullName],
            ["Permanent Address", rec.address],
            ["Contact Number", rec.contact],
            ["Email", rec.email || "—"],
            ["Date of Incident", rec.incidentDate],
            ["Location", rec.location],
            ["Type of Complaint", rec.type],
            ["Detailed Description", rec.description],
            ["Details of Accused", rec.accused || "—"],
            ["Evidence", rec.evidence || "—"],
            ["Status", rec.status || "—"],
            ["Submitted At", rec.submittedAt || "—"],
          ];

          const lineHeight = 18;
          rows.forEach(([label, value]) => {
            if (y > 720) {
              doc.addPage();
              y = 60;
            }
            doc.setFont(undefined, "bold");
            doc.text(label + ":", left, y);
            doc.setFont(undefined, "normal");
            // wrap text for long values
            const split = doc.splitTextToSize(value, 450);
            doc.text(split, left + 140, y);
            y += lineHeight * split.length;
            y += 8;
          });

          const fileName = `Samanta_Complaint_${rec.darta.replace(
            /\s+/g,
            "_"
          )}.pdf`;
          doc.save(fileName);
        }

        // Search functionality
        function doSearch() {
          const q = (searchInput.value || "").trim().toLowerCase();
          if (!q) {
            renderTable();
            return;
          }

          // If matches exact Darta number (like D-001) show detail directly
          const byDarta = complaints.find((c) => c.darta.toLowerCase() === q);
          if (byDarta) {
            showDetail(byDarta);
            return;
          }

          // else: filter by name or darta substring
          const filtered = complaints.filter((c) => {
            return (
              (c.fullName || "").toLowerCase().includes(q) ||
              (c.darta || "").toLowerCase().includes(q) ||
              (c.contact || "").includes(q)
            );
          });
          renderTable(filtered);
        }

        // CSV Download
        function downloadCSV() {
          const rows = [
            [
              "Darta Number",
              "Full Name",
              "Contact",
              "Email",
              "Address",
              "Date of Incident",
              "Type",
              "Status",
            ],
          ];
          complaints.forEach((c) => {
            rows.push([
              c.darta,
              c.fullName,
              c.contact,
              c.email || "",
              c.address,
              c.incidentDate,
              c.type,
              c.status || "",
            ]);
          });
          const csv = rows
            .map((r) =>
              r
                .map((cell) => `"${String(cell || "").replace(/"/g, '""')}"`)
                .join(",")
            )
            .join("\n");
          const blob = new Blob([csv], { type: "text/csv;charset=utf-8;" });
          const url = URL.createObjectURL(blob);
          const a = document.createElement("a");
          a.href = url;
          a.download = "Samanta_Complaints.csv";
          document.body.appendChild(a);
          a.click();
          document.body.removeChild(a);
          URL.revokeObjectURL(url);
        }

        // event bindings
        searchBtn.addEventListener("click", doSearch);
        searchInput.addEventListener("keydown", (e) => {
          if (e.key === "Enter") {
            e.preventDefault();
            doSearch();
          }
        });
        downloadCsvBtn.addEventListener("click", downloadCSV);
        backToList.addEventListener("click", (e) => {
          e.preventDefault();
          detailCard.style.display = "none";
          window.scrollTo({ top: 0, behavior: "smooth" });
        });

        // initial render
        renderTable();
      })();
    </script>
  </body>
</html>
